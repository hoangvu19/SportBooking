/**
 * Complete seed script: SportTypes + Facilities + SportFields
 * Usage: node scripts/seed-all-data.js
 */

const { poolPromise } = require('../config/db');
const sql = require('mssql');

// Sport Types data
const sportTypes = [
  { id: 1, name: 'B√≥ng ƒê√°' },
  { id: 2, name: 'B√≥ng R·ªï' },
  { id: 3, name: 'C·∫ßu L√¥ng' },
  { id: 4, name: 'Tennis' },
  { id: 5, name: 'B√≥ng Chuy·ªÅn' },
  { id: 6, name: 'B∆°i L·ªôi' },
];

// Facilities data
const facilities = [
  { id: 1, name: 'S√¢n B√≥ng Th·ªÉ Thao A', areaId: 1, ownerId: 1 },
  { id: 2, name: 'Trung T√¢m Th·ªÉ Thao B', areaId: 1, ownerId: 1 },
  { id: 3, name: 'C√¢u L·∫°c B·ªô C·∫ßu L√¥ng C', areaId: 1, ownerId: 1 },
  { id: 4, name: 'S√¢n Tennis D', areaId: 1, ownerId: 1 },
  { id: 5, name: 'Trung T√¢m ƒêa NƒÉng E', areaId: 1, ownerId: 1 },
  { id: 6, name: 'B·ªÉ B∆°i F', areaId: 1, ownerId: 1 },
];

// Sport Fields data (20 fields)
const sportFields = [
  // S√¢n b√≥ng ƒë√° (Soccer)
  { fieldName: 'S√¢n B√≥ng ƒê√° Mini 1', fieldType: '5v5', rentalPrice: 300000, status: 'Available', facilityId: 1, sportTypeId: 1 },
  { fieldName: 'S√¢n B√≥ng ƒê√° Mini 2', fieldType: '5v5', rentalPrice: 320000, status: 'Available', facilityId: 1, sportTypeId: 1 },
  { fieldName: 'S√¢n B√≥ng ƒê√° 7 Ng∆∞·ªùi', fieldType: '7v7', rentalPrice: 500000, status: 'Available', facilityId: 1, sportTypeId: 1 },
  { fieldName: 'S√¢n B√≥ng ƒê√° 11 Ng∆∞·ªùi', fieldType: '11v11', rentalPrice: 800000, status: 'Available', facilityId: 1, sportTypeId: 1 },
  { fieldName: 'S√¢n B√≥ng ƒê√° C·ªè Nh√¢n T·∫°o A', fieldType: '5v5', rentalPrice: 350000, status: 'Available', facilityId: 2, sportTypeId: 1 },
  
  // S√¢n b√≥ng r·ªï (Basketball)
  { fieldName: 'S√¢n B√≥ng R·ªï Trong Nh√† 1', fieldType: 'Indoor', rentalPrice: 250000, status: 'Available', facilityId: 2, sportTypeId: 2 },
  { fieldName: 'S√¢n B√≥ng R·ªï Ngo√†i Tr·ªùi 1', fieldType: 'Outdoor', rentalPrice: 200000, status: 'Available', facilityId: 2, sportTypeId: 2 },
  { fieldName: 'S√¢n B√≥ng R·ªï Pro Court', fieldType: 'Indoor', rentalPrice: 300000, status: 'Available', facilityId: 3, sportTypeId: 2 },
  
  // S√¢n c·∫ßu l√¥ng (Badminton)
  { fieldName: 'S√¢n C·∫ßu L√¥ng A1', fieldType: 'Single', rentalPrice: 80000, status: 'Available', facilityId: 3, sportTypeId: 3 },
  { fieldName: 'S√¢n C·∫ßu L√¥ng A2', fieldType: 'Single', rentalPrice: 80000, status: 'Available', facilityId: 3, sportTypeId: 3 },
  { fieldName: 'S√¢n C·∫ßu L√¥ng B1', fieldType: 'Double', rentalPrice: 100000, status: 'Available', facilityId: 3, sportTypeId: 3 },
  { fieldName: 'S√¢n C·∫ßu L√¥ng B2', fieldType: 'Double', rentalPrice: 100000, status: 'Available', facilityId: 3, sportTypeId: 3 },
  { fieldName: 'S√¢n C·∫ßu L√¥ng VIP', fieldType: 'Double', rentalPrice: 150000, status: 'Available', facilityId: 4, sportTypeId: 3 },
  
  // S√¢n tennis (Tennis)
  { fieldName: 'S√¢n Tennis ƒê∆°n 1', fieldType: 'Singles', rentalPrice: 200000, status: 'Available', facilityId: 4, sportTypeId: 4 },
  { fieldName: 'S√¢n Tennis ƒê√¥i 1', fieldType: 'Doubles', rentalPrice: 250000, status: 'Available', facilityId: 4, sportTypeId: 4 },
  { fieldName: 'S√¢n Tennis Pro', fieldType: 'Doubles', rentalPrice: 300000, status: 'Available', facilityId: 5, sportTypeId: 4 },
  
  // S√¢n b√≥ng chuy·ªÅn (Volleyball)
  { fieldName: 'S√¢n B√≥ng Chuy·ªÅn 1', fieldType: 'Indoor', rentalPrice: 200000, status: 'Available', facilityId: 5, sportTypeId: 5 },
  { fieldName: 'S√¢n B√≥ng Chuy·ªÅn B√£i Bi·ªÉn', fieldType: 'Beach', rentalPrice: 250000, status: 'Available', facilityId: 5, sportTypeId: 5 },
  
  // S√¢n b∆°i (Swimming)
  { fieldName: 'B·ªÉ B∆°i Olympic 1', fieldType: '50m', rentalPrice: 150000, status: 'Available', facilityId: 6, sportTypeId: 6 },
  { fieldName: 'B·ªÉ B∆°i Tr·∫ª Em', fieldType: '25m', rentalPrice: 100000, status: 'Available', facilityId: 6, sportTypeId: 6 },
];

async function seedAllData() {
  console.log('\n' + '='.repeat(70));
  console.log('üöÄ COMPLETE DATABASE SEEDING');
  console.log('='.repeat(70));
  console.log(`Time: ${new Date().toLocaleString('vi-VN')}\n`);
  
  try {
    const pool = await poolPromise;
    
    // ========================
    // 1. SEED SPORT TYPES
    // ========================
    console.log('üìù Step 1: Seeding Sport Types...');
    let sportTypeCount = 0;
    
    for (const st of sportTypes) {
      try {
        // Check if exists
        const existing = await pool.request()
          .input('SportTypeID', sql.Int, st.id)
          .query('SELECT * FROM SportType WHERE SportTypeID = @SportTypeID');
        
        if (existing.recordset.length > 0) {
          console.log(`   ‚è≠Ô∏è  [${st.id}] ${st.name} - Already exists`);
        } else {
          await pool.request()
            .input('SportTypeID', sql.Int, st.id)
            .input('SportName', sql.VarChar, st.name)
            .query(`
              SET IDENTITY_INSERT SportType ON;
              INSERT INTO SportType (SportTypeID, SportName)
              VALUES (@SportTypeID, @SportName);
              SET IDENTITY_INSERT SportType OFF;
            `);
          console.log(`   ‚úÖ [${st.id}] ${st.name}`);
          sportTypeCount++;
        }
      } catch (error) {
        console.error(`   ‚ùå Failed to insert ${st.name}:`, error.message);
      }
    }
    
    console.log(`\n   Summary: ${sportTypeCount} sport types inserted\n`);
    
    // ========================
    // 2. SEED FACILITIES
    // ========================
    console.log('üìù Step 2: Seeding Facilities...');
    let facilityCount = 0;
    
    for (const f of facilities) {
      try {
        // Check if exists
        const existing = await pool.request()
          .input('FacilityID', sql.Int, f.id)
          .query('SELECT * FROM Facility WHERE FacilityID = @FacilityID');
        
        if (existing.recordset.length > 0) {
          console.log(`   ‚è≠Ô∏è  [${f.id}] ${f.name} - Already exists`);
        } else {
          await pool.request()
            .input('FacilityID', sql.Int, f.id)
            .input('FacilityName', sql.VarChar, f.name)
            .input('AreaID', sql.Int, f.areaId)
            .input('OwnerID', sql.Int, f.ownerId)
            .query(`
              SET IDENTITY_INSERT Facility ON;
              INSERT INTO Facility (FacilityID, FacilityName, AreaID, OwnerID)
              VALUES (@FacilityID, @FacilityName, @AreaID, @OwnerID);
              SET IDENTITY_INSERT Facility OFF;
            `);
          console.log(`   ‚úÖ [${f.id}] ${f.name}`);
          facilityCount++;
        }
      } catch (error) {
        console.error(`   ‚ùå Failed to insert ${f.name}:`, error.message);
      }
    }
    
    console.log(`\n   Summary: ${facilityCount} facilities inserted\n`);
    
    // ========================
    // 3. SEED SPORT FIELDS
    // ========================
    console.log('üìù Step 3: Seeding Sport Fields...');
    let fieldCount = 0;
    
    for (const field of sportFields) {
      try {
        const result = await pool.request()
          .input('FieldName', sql.VarChar, field.fieldName)
          .input('FieldType', sql.VarChar, field.fieldType)
          .input('RentalPrice', sql.Decimal(10, 2), field.rentalPrice)
          .input('Status', sql.VarChar, field.status)
          .input('FacilityID', sql.Int, field.facilityId)
          .input('SportTypeID', sql.Int, field.sportTypeId)
          .query(`
            INSERT INTO SportField (FieldName, FieldType, RentalPrice, Status, FacilityID, SportTypeID)
            OUTPUT INSERTED.FieldID, INSERTED.FieldName, INSERTED.RentalPrice
            VALUES (@FieldName, @FieldType, @RentalPrice, @Status, @FacilityID, @SportTypeID)
          `);
        
        const inserted = result.recordset[0];
        console.log(`   ‚úÖ [${inserted.FieldID}] ${inserted.FieldName} - ${inserted.RentalPrice.toLocaleString('vi-VN')}ƒë`);
        fieldCount++;
        
      } catch (error) {
        console.error(`   ‚ùå Failed to insert ${field.fieldName}:`, error.message);
      }
    }
    
    console.log(`\n   Summary: ${fieldCount} sport fields inserted\n`);
    
    // ========================
    // 4. FINAL REPORT
    // ========================
    console.log('='.repeat(70));
    console.log('üìä FINAL SUMMARY');
    console.log('='.repeat(70));
    
    // Count all data
    const sportTypeTotal = await pool.request().query('SELECT COUNT(*) as count FROM SportType');
    const facilityTotal = await pool.request().query('SELECT COUNT(*) as count FROM Facility');
    const fieldTotal = await pool.request().query('SELECT COUNT(*) as count FROM SportField');
    
    console.log(`‚úÖ Sport Types: ${sportTypeTotal.recordset[0].count} total`);
    console.log(`‚úÖ Facilities: ${facilityTotal.recordset[0].count} total`);
    console.log(`‚úÖ Sport Fields: ${fieldTotal.recordset[0].count} total`);
    console.log('='.repeat(70));
    
    // Show all sport fields
    console.log('\nüìã ALL SPORT FIELDS IN DATABASE:\n');
    const allFields = await pool.request().query(`
      SELECT 
        sf.FieldID,
        sf.FieldName,
        sf.FieldType,
        sf.RentalPrice,
        sf.Status,
        f.FacilityName,
        st.SportName
      FROM SportField sf
      LEFT JOIN Facility f ON sf.FacilityID = f.FacilityID
      LEFT JOIN SportType st ON sf.SportTypeID = st.SportTypeID
      ORDER BY st.SportName, sf.FieldID
    `);
    
    let currentSport = null;
    allFields.recordset.forEach((field, index) => {
      if (currentSport !== field.SportName) {
        currentSport = field.SportName;
        console.log(`\nüèÜ ${currentSport}:`);
      }
      console.log(`  ${index + 1}. [ID: ${field.FieldID}] ${field.FieldName}`);
      console.log(`     Type: ${field.FieldType} | Price: ${field.RentalPrice.toLocaleString('vi-VN')}ƒë/hour`);
      console.log(`     Facility: ${field.FacilityName} | Status: ${field.Status}`);
    });
    
    console.log('\n‚úÖ Database seeding completed successfully!');
    
  } catch (error) {
    console.error('\n‚ùå Error during seeding:', error);
    throw error;
  } finally {
    const pool = await poolPromise;
    await pool.close();
    console.log('\nüîå Database connection closed\n');
  }
}

// Run the seeding
seedAllData()
  .then(() => {
    console.log('‚úÖ Script finished successfully\n');
    process.exit(0);
  })
  .catch((error) => {
    console.error('‚ùå Script failed:', error);
    process.exit(1);
  });
